<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml" />






<meta name="description" content="mybatis源码配置文件加载过程mybatis Demo123456789101112131415161718192021public static void main(String[] args) throws Exception &amp;#123;       //io加载配置文件       InputStream in=Main.class.getResourceAsStream(&amp;quot;">
<meta property="og:type" content="article">
<meta property="og:title" content="mybatis源码配置文件加载过程">
<meta property="og:url" content="http://yoursite.com/2018/04/20/mybatis3源码/mybatis源码配置文件加载过程/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="mybatis源码配置文件加载过程mybatis Demo123456789101112131415161718192021public static void main(String[] args) throws Exception &amp;#123;       //io加载配置文件       InputStream in=Main.class.getResourceAsStream(&amp;quot;">
<meta property="og:updated_time" content="2018-04-23T12:14:17.336Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="mybatis源码配置文件加载过程">
<meta name="twitter:description" content="mybatis源码配置文件加载过程mybatis Demo123456789101112131415161718192021public static void main(String[] args) throws Exception &amp;#123;       //io加载配置文件       InputStream in=Main.class.getResourceAsStream(&amp;quot;">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/04/20/mybatis3源码/mybatis源码配置文件加载过程/"/>





  <title>mybatis源码配置文件加载过程 | Hexo</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            Über
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Kategorien
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/20/mybatis3源码/mybatis源码配置文件加载过程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">mybatis源码配置文件加载过程</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-20T20:41:54+08:00">
                2018-04-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mybatis3/" itemprop="url" rel="index">
                    <span itemprop="name">mybatis3</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="mybatis源码配置文件加载过程"><a href="#mybatis源码配置文件加载过程" class="headerlink" title="mybatis源码配置文件加载过程"></a>mybatis源码配置文件加载过程</h2><h3 id="mybatis-Demo"><a href="#mybatis-Demo" class="headerlink" title="mybatis Demo"></a>mybatis Demo</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) throws Exception &#123;</span><br><span class="line">       //io加载配置文件</span><br><span class="line">       InputStream in=Main.class.getResourceAsStream(&quot;resource/mybatis-cfg.xml&quot;);</span><br><span class="line">       //根据inputstream构建session工厂</span><br><span class="line">       SqlSessionFactory factory=new SqlSessionFactoryBuilder().build(in);</span><br><span class="line">       //创建session</span><br><span class="line">       SqlSession session=factory.openSession();</span><br><span class="line">       //取得mapper对象 调用mapper方法</span><br><span class="line">       DemoMapper mapper=session.getMapper(DemoMapper.class);</span><br><span class="line">       Demo demo=new Demo();</span><br><span class="line">       demo.setId(20);</span><br><span class="line">       demo.setName(&quot;demo&quot;);</span><br><span class="line">       mapper.insertStudent(demo);</span><br><span class="line">       demo=mapper.selectOneById(2);</span><br><span class="line">       List&lt;Demo&gt; demoList=mapper.selectAllDemo();</span><br><span class="line">       //提交，insert需要提交</span><br><span class="line">       session.commit();</span><br><span class="line">       //关闭资源</span><br><span class="line">       session.close();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h3 id="一、属性和别名加载过程"><a href="#一、属性和别名加载过程" class="headerlink" title="一、属性和别名加载过程"></a>一、属性和别名加载过程</h3><h4 id="1、SqlSessionFactoryBuilder的build方法"><a href="#1、SqlSessionFactoryBuilder的build方法" class="headerlink" title="1、SqlSessionFactoryBuilder的build方法"></a>1、SqlSessionFactoryBuilder的build方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public SqlSessionFactory build(InputStream inputStream, String environment, Properties properties) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        XMLConfigBuilder parser = new XMLConfigBuilder(inputStream, environment, properties);</span><br><span class="line">        //XMLConfigBuilder.parse(),解析配置文件，返回了一个Configuration对象 </span><br><span class="line">        return build(parser.parse());</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        throw ExceptionFactory.wrapException(&quot;Error building SqlSession.&quot;, e);</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        ErrorContext.instance().reset();</span><br><span class="line">        try &#123;</span><br><span class="line">            inputStream.close();</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            // Intentionally ignore. Prefer previous error.</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2、XMLConfigBuilder的parse方法"><a href="#2、XMLConfigBuilder的parse方法" class="headerlink" title="2、XMLConfigBuilder的parse方法"></a>2、XMLConfigBuilder的parse方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> public Configuration parse() &#123;</span><br><span class="line">     if (parsed) &#123;</span><br><span class="line">         throw new BuilderException(&quot;Each XMLConfigBuilder can only be used once.&quot;);</span><br><span class="line">     &#125;</span><br><span class="line">     parsed = true;</span><br><span class="line">     //解析配置文件configuration节点，加载到Configuration对象中</span><br><span class="line">     parseConfiguration(parser.evalNode(&quot;/configuration&quot;));</span><br><span class="line">     return configuration;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3、XMLConfigBuilder的parseConfiguration方法"><a href="#3、XMLConfigBuilder的parseConfiguration方法" class="headerlink" title="3、XMLConfigBuilder的parseConfiguration方法"></a>3、XMLConfigBuilder的parseConfiguration方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">private void parseConfiguration(XNode root) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        //加载properties节点,一般是定义一些变量</span><br><span class="line">        propertiesElement(root.evalNode(&quot;properties&quot;)); </span><br><span class="line">        //加载别名</span><br><span class="line">        typeAliasesElement(root.evalNode(&quot;typeAliases&quot;));</span><br><span class="line">        //拦截器</span><br><span class="line">        pluginElement(root.evalNode(&quot;plugins&quot;));</span><br><span class="line">        objectFactoryElement(root.evalNode(&quot;objectFactory&quot;));</span><br><span class="line">        objectWrapperFactoryElement(root.evalNode(&quot;objectWrapperFactory&quot;));</span><br><span class="line">        settingsElement(root.evalNode(&quot;settings&quot;));</span><br><span class="line">        //环境</span><br><span class="line">        environmentsElement(root.evalNode(&quot;environments&quot;)); </span><br><span class="line">        databaseIdProviderElement(root.evalNode(&quot;databaseIdProvider&quot;));</span><br><span class="line">        typeHandlerElement(root.evalNode(&quot;typeHandlers&quot;));</span><br><span class="line">        //加载Mapper的配置文件，最主要的有两个：一个是sql的定义，一个是resultMap</span><br><span class="line">        mapperElement(root.evalNode(&quot;mappers&quot;));</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        throw new BuilderException(&quot;Error parsing SQL Mapper Configuration. Cause: &quot; + e, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4、XMLConfigBuilder的propertiesElement方法"><a href="#4、XMLConfigBuilder的propertiesElement方法" class="headerlink" title="4、XMLConfigBuilder的propertiesElement方法"></a>4、XMLConfigBuilder的propertiesElement方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">private void propertiesElement(XNode context) throws Exception &#123;</span><br><span class="line">    if (context != null) &#123;</span><br><span class="line">        //先加载property子节点下的属性</span><br><span class="line">        Properties defaults = context.getChildrenAsProperties();</span><br><span class="line">        String resource = context.getStringAttribute(&quot;resource&quot;);</span><br><span class="line">        String url = context.getStringAttribute(&quot;url&quot;)</span><br><span class="line">        //不能同时设置resource属性和url属性</span><br><span class="line">        if (resource != null &amp;&amp; url != null) &#123;</span><br><span class="line">            throw new BuilderException(&quot;The properties element cannot specify both a URL and a resource based property file reference.  Please specify one or the other.&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        if (resource != null) &#123;</span><br><span class="line">            //会覆盖子节点的配置</span><br><span class="line">            defaults.putAll(Resources.getResourceAsProperties(resource));</span><br><span class="line">        &#125; else if (url != null) &#123;</span><br><span class="line">            //会覆盖子节点的配置</span><br><span class="line">            defaults.putAll(Resources.getUrlAsProperties(url));</span><br><span class="line">        &#125;</span><br><span class="line">        Properties vars = configuration.getVariables();</span><br><span class="line">        if (vars != null) &#123;</span><br><span class="line">            defaults.putAll(vars);</span><br><span class="line">        &#125;</span><br><span class="line">        parser.setVariables(defaults);</span><br><span class="line">        //加载到configuration中</span><br><span class="line">        configuration.setVariables(defaults);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>properties配置示例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties resource=&quot;resource/config.properties&quot;&gt;  </span><br><span class="line">    &lt;property name=&quot;username&quot; value=&quot;dev&quot;/&gt;  </span><br><span class="line">    &lt;property name=&quot;password&quot; value=&quot;12345&quot;/&gt;  </span><br><span class="line">&lt;/properties&gt;</span><br></pre></td></tr></table></figure></p>
<h4 id="5、接（一、3）XMLConfigBuilder的typeAliasesElement方法"><a href="#5、接（一、3）XMLConfigBuilder的typeAliasesElement方法" class="headerlink" title="5、接（一、3）XMLConfigBuilder的typeAliasesElement方法"></a>5、接（一、3）XMLConfigBuilder的typeAliasesElement方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">private void typeAliasesElement(XNode parent) &#123;</span><br><span class="line">    if (parent != null) &#123;</span><br><span class="line">        for (XNode child : parent.getChildren()) &#123;</span><br><span class="line">            if (&quot;package&quot;.equals(child.getName())) &#123;</span><br><span class="line">                String typeAliasPackage = child.getStringAttribute(&quot;name&quot;);</span><br><span class="line">                //package的方式，将包下所有类的注解别名(若无则用类名作为别名)，注册到TypeAliasRegistry的TYPE_ALIASES中</span><br><span class="line">                configuration.getTypeAliasRegistry().registerAliases(typeAliasPackage);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                //获取别名</span><br><span class="line">                String alias = child.getStringAttribute(&quot;alias&quot;);</span><br><span class="line">                //获取类全名</span><br><span class="line">                String type = child.getStringAttribute(&quot;type&quot;);</span><br><span class="line">                try &#123;</span><br><span class="line">                    //获取类</span><br><span class="line">                    Class&lt;?&gt; clazz = Resources.classForName(type);</span><br><span class="line">                    if (alias == null) &#123;</span><br><span class="line">                        //以类名作为别名注册</span><br><span class="line">                        typeAliasRegistry.registerAlias(clazz);</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        //注册别名</span><br><span class="line">                        typeAliasRegistry.registerAlias(alias, clazz);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">                    throw new BuilderException(&quot;Error registering typeAlias for &apos;&quot; + alias + &quot;&apos;. Cause: &quot; + e, e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>typeAliases配置示例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;typeAliases&gt;</span><br><span class="line">    &lt;!-- 单个别名定义 --&gt;</span><br><span class="line">    &lt;typeAlias alias=&quot;demo&quot; type=&quot;com.mhr.dto.Demo&quot;/&gt;</span><br><span class="line">    &lt;!-- 批量别名定义，扫描整个包下的类，别名为类名（首字母大写或小写都可以） --&gt;</span><br><span class="line">    &lt;package name=&quot;com.mhr.dto&quot;/&gt;</span><br><span class="line">&lt;/typeAliases&gt;</span><br></pre></td></tr></table></figure></p>
<h4 id="6、实例化TypeAliasRegistry"><a href="#6、实例化TypeAliasRegistry" class="headerlink" title="6、实例化TypeAliasRegistry"></a>6、实例化TypeAliasRegistry</h4><p>//默认别名配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">public TypeAliasRegistry() &#123;</span><br><span class="line">    registerAlias(&quot;string&quot;, String.class);</span><br><span class="line"></span><br><span class="line">    registerAlias(&quot;byte&quot;, Byte.class);</span><br><span class="line">    registerAlias(&quot;long&quot;, Long.class);</span><br><span class="line">    registerAlias(&quot;short&quot;, Short.class);</span><br><span class="line">    registerAlias(&quot;int&quot;, Integer.class);</span><br><span class="line">    registerAlias(&quot;integer&quot;, Integer.class);</span><br><span class="line">    registerAlias(&quot;double&quot;, Double.class);</span><br><span class="line">    registerAlias(&quot;float&quot;, Float.class);</span><br><span class="line">    registerAlias(&quot;boolean&quot;, Boolean.class);</span><br><span class="line"></span><br><span class="line">    registerAlias(&quot;byte[]&quot;, Byte[].class);</span><br><span class="line">    registerAlias(&quot;long[]&quot;, Long[].class);</span><br><span class="line">    registerAlias(&quot;short[]&quot;, Short[].class);</span><br><span class="line">    registerAlias(&quot;int[]&quot;, Integer[].class);</span><br><span class="line">    registerAlias(&quot;integer[]&quot;, Integer[].class);</span><br><span class="line">    registerAlias(&quot;double[]&quot;, Double[].class);</span><br><span class="line">    registerAlias(&quot;float[]&quot;, Float[].class);</span><br><span class="line">    registerAlias(&quot;boolean[]&quot;, Boolean[].class);</span><br><span class="line"></span><br><span class="line">    registerAlias(&quot;_byte&quot;, byte.class);</span><br><span class="line">    registerAlias(&quot;_long&quot;, long.class);</span><br><span class="line">    registerAlias(&quot;_short&quot;, short.class);</span><br><span class="line">    registerAlias(&quot;_int&quot;, int.class);</span><br><span class="line">    registerAlias(&quot;_integer&quot;, int.class);</span><br><span class="line">    registerAlias(&quot;_double&quot;, double.class);</span><br><span class="line">    registerAlias(&quot;_float&quot;, float.class);</span><br><span class="line">    registerAlias(&quot;_boolean&quot;, boolean.class);</span><br><span class="line"></span><br><span class="line">    registerAlias(&quot;_byte[]&quot;, byte[].class);</span><br><span class="line">    registerAlias(&quot;_long[]&quot;, long[].class);</span><br><span class="line">    registerAlias(&quot;_short[]&quot;, short[].class);</span><br><span class="line">    registerAlias(&quot;_int[]&quot;, int[].class);</span><br><span class="line">    registerAlias(&quot;_integer[]&quot;, int[].class);</span><br><span class="line">    registerAlias(&quot;_double[]&quot;, double[].class);</span><br><span class="line">    registerAlias(&quot;_float[]&quot;, float[].class);</span><br><span class="line">    registerAlias(&quot;_boolean[]&quot;, boolean[].class);</span><br><span class="line"></span><br><span class="line">    registerAlias(&quot;date&quot;, Date.class);</span><br><span class="line">    registerAlias(&quot;decimal&quot;, BigDecimal.class);</span><br><span class="line">    registerAlias(&quot;bigdecimal&quot;, BigDecimal.class);</span><br><span class="line">    registerAlias(&quot;biginteger&quot;, BigInteger.class);</span><br><span class="line">    registerAlias(&quot;object&quot;, Object.class);</span><br><span class="line"></span><br><span class="line">    registerAlias(&quot;date[]&quot;, Date[].class);</span><br><span class="line">    registerAlias(&quot;decimal[]&quot;, BigDecimal[].class);</span><br><span class="line">    registerAlias(&quot;bigdecimal[]&quot;, BigDecimal[].class);</span><br><span class="line">    registerAlias(&quot;biginteger[]&quot;, BigInteger[].class);</span><br><span class="line">    registerAlias(&quot;object[]&quot;, Object[].class);</span><br><span class="line"></span><br><span class="line">    registerAlias(&quot;map&quot;, Map.class);</span><br><span class="line">    registerAlias(&quot;hashmap&quot;, HashMap.class);</span><br><span class="line">    registerAlias(&quot;list&quot;, List.class);</span><br><span class="line">    registerAlias(&quot;arraylist&quot;, ArrayList.class);</span><br><span class="line">    registerAlias(&quot;collection&quot;, Collection.class);</span><br><span class="line">    registerAlias(&quot;iterator&quot;, Iterator.class);</span><br><span class="line"></span><br><span class="line">    registerAlias(&quot;ResultSet&quot;, ResultSet.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="7、接（一、3）XMLConfigBuilder的environmentsElement方法"><a href="#7、接（一、3）XMLConfigBuilder的environmentsElement方法" class="headerlink" title="7、接（一、3）XMLConfigBuilder的environmentsElement方法"></a>7、接（一、3）XMLConfigBuilder的environmentsElement方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">private void environmentsElement(XNode context) throws Exception &#123;</span><br><span class="line">    if (context != null) &#123;</span><br><span class="line">        if (environment == null) &#123;</span><br><span class="line">            //获取默认环境</span><br><span class="line">            environment = context.getStringAttribute(&quot;default&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        for (XNode child : context.getChildren()) &#123;</span><br><span class="line">            String id = child.getStringAttribute(&quot;id&quot;);</span><br><span class="line">            //判断id是否等于默认</span><br><span class="line">            if (isSpecifiedEnvironment(id)) &#123;</span><br><span class="line">                //创建事务工厂，JdbcTransactionFactory</span><br><span class="line">                TransactionFactory txFactory = transactionManagerElement(child.evalNode(&quot;transactionManager&quot;));</span><br><span class="line">                //创建数据源工厂，PooledDataSourceFactory</span><br><span class="line">                DataSourceFactory dsFactory = dataSourceElement(child.evalNode(&quot;dataSource&quot;));</span><br><span class="line">                //获取数据源,PooledDataSource</span><br><span class="line">                DataSource dataSource = dsFactory.getDataSource();</span><br><span class="line">                Environment.Builder environmentBuilder = new Environment.Builder(id)</span><br><span class="line">                      .transactionFactory(txFactory)</span><br><span class="line">                      .dataSource(dataSource);</span><br><span class="line">                //将环境加载到configuration中</span><br><span class="line">                configuration.setEnvironment(environmentBuilder.build());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>environment配置示例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;environments default=&quot;development&quot;&gt;  </span><br><span class="line">     &lt;environment id=&quot;development&quot;&gt;  </span><br><span class="line">         &lt;transactionManager type=&quot;JDBC&quot; /&gt;  </span><br><span class="line">         &lt;!-- 配置数据库连接信息 --&gt;  </span><br><span class="line">         &lt;dataSource type=&quot;POOLED&quot;&gt;  </span><br><span class="line">             &lt;!-- value属性值引用db.properties配置文件中配置的值 --&gt;  </span><br><span class="line">             &lt;property name=&quot;driver&quot; value=&quot;$&#123;driver&#125;&quot; /&gt;  </span><br><span class="line">             &lt;property name=&quot;url&quot; value=&quot;$&#123;url&#125;&quot; /&gt;  </span><br><span class="line">             &lt;property name=&quot;username&quot; value=&quot;$&#123;name&#125;&quot; /&gt;  </span><br><span class="line">             &lt;property name=&quot;password&quot; value=&quot;$&#123;password&#125;&quot; /&gt;  </span><br><span class="line">         &lt;/dataSource&gt;  </span><br><span class="line">     &lt;/environment&gt;  </span><br><span class="line"> &lt;/environments&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="二、mapper文件加载过程"><a href="#二、mapper文件加载过程" class="headerlink" title="二、mapper文件加载过程"></a>二、mapper文件加载过程</h3><h4 id="1、接（一、3）XMLConfigBuilder的mapperElement方法"><a href="#1、接（一、3）XMLConfigBuilder的mapperElement方法" class="headerlink" title="1、接（一、3）XMLConfigBuilder的mapperElement方法"></a>1、接（一、3）XMLConfigBuilder的mapperElement方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">private void mapperElement(XNode parent) throws Exception &#123;</span><br><span class="line">    if (parent != null) &#123;</span><br><span class="line">        for (XNode child : parent.getChildren()) &#123;</span><br><span class="line">            if (&quot;package&quot;.equals(child.getName())) &#123;</span><br><span class="line">                String mapperPackage = child.getStringAttribute(&quot;name&quot;);</span><br><span class="line">                configuration.addMappers(mapperPackage);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                String resource = child.getStringAttribute(&quot;resource&quot;);</span><br><span class="line">                String url = child.getStringAttribute(&quot;url&quot;);</span><br><span class="line">                String mapperClass = child.getStringAttribute(&quot;class&quot;);</span><br><span class="line">                if (resource != null &amp;&amp; url == null &amp;&amp; mapperClass == null) &#123;</span><br><span class="line">                    ErrorContext.instance().resource(resource);</span><br><span class="line">                    InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">                    //由XMLMapperBuilder对象解析加载 </span><br><span class="line">                    XMLMapperBuilder mapperParser = new XMLMapperBuilder(inputStream, configuration, resource, configuration.getSqlFragments());</span><br><span class="line">                    mapperParser.parse();</span><br><span class="line">                &#125; else if (resource == null &amp;&amp; url != null &amp;&amp; mapperClass == null) &#123;</span><br><span class="line">                    ErrorContext.instance().resource(url);</span><br><span class="line">                    InputStream inputStream = Resources.getUrlAsStream(url);</span><br><span class="line">                    //由XMLMapperBuilder对象解析加载</span><br><span class="line">                    XMLMapperBuilder mapperParser = new XMLMapperBuilder(inputStream, configuration, url, configuration.getSqlFragments());</span><br><span class="line">                    mapperParser.parse();</span><br><span class="line">                &#125; else if (resource == null &amp;&amp; url == null &amp;&amp; mapperClass != null) &#123;</span><br><span class="line">                    Class&lt;?&gt; mapperInterface = Resources.classForName(mapperClass);</span><br><span class="line">                    configuration.addMapper(mapperInterface);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    throw new BuilderException(&quot;A mapper element may only specify a url, resource or class, but not more than one.&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>mappers配置示例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;mappers&gt;       </span><br><span class="line">    //class 级别的指定,非注解模式的话xml配置文件必须和这个类在同一级目录，且与Mapper类同名  </span><br><span class="line">    &lt;mapper class=&quot;com.mhr.mapper.DemoMapper&quot;/&gt;  </span><br><span class="line">    //非注解模式的话xml配置文件必须也处于同一级 package 下，且与Mapper类同名</span><br><span class="line">    &lt;package name=&quot;com.mhr.mapper&quot;/&gt; </span><br><span class="line">    //使用这个方案，可以单独指定Mapper的位置 </span><br><span class="line">    &lt;mapper resource=&quot;mybatis/mappings/DemoMapper.xml&quot;/&gt;  </span><br><span class="line">&lt;/mappers&gt;</span><br></pre></td></tr></table></figure></p>
<h4 id="2、XMLMapperBuilder的parse方法"><a href="#2、XMLMapperBuilder的parse方法" class="headerlink" title="2、XMLMapperBuilder的parse方法"></a>2、XMLMapperBuilder的parse方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">  public void parse() &#123;</span><br><span class="line">      if (!configuration.isResourceLoaded(resource)) &#123;</span><br><span class="line">          //真正解析</span><br><span class="line">          configurationElement(parser.evalNode(&quot;/mapper&quot;));</span><br><span class="line"></span><br><span class="line">          configuration.addLoadedResource(resource);</span><br><span class="line">          bindMapperForNamespace();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      parsePendingResultMaps();</span><br><span class="line">      parsePendingChacheRefs();</span><br><span class="line">      parsePendingStatements();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3、XMLMapperBuilder的configurationElement方法"><a href="#3、XMLMapperBuilder的configurationElement方法" class="headerlink" title="3、XMLMapperBuilder的configurationElement方法"></a>3、XMLMapperBuilder的configurationElement方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">private void configurationElement(XNode context) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        //命名空间</span><br><span class="line">        String namespace = context.getStringAttribute(&quot;namespace&quot;);</span><br><span class="line">        if (namespace.equals(&quot;&quot;)) &#123;</span><br><span class="line">            throw new BuilderException(&quot;Mapper&apos;s namespace cannot be empty&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        builderAssistant.setCurrentNamespace(namespace);</span><br><span class="line">        //引用其他命名空间中的缓存</span><br><span class="line">        cacheRefElement(context.evalNode(&quot;cache-ref&quot;));</span><br><span class="line">        //为当前的命名空间配置缓存</span><br><span class="line">        cacheElement(context.evalNode(&quot;cache&quot;));</span><br><span class="line">        //解析parameterMap节点，Mybatis3中官方已经不推荐使用parameterMap配置</span><br><span class="line">        parameterMapElement(context.evalNodes(&quot;/mapper/parameterMap&quot;));</span><br><span class="line">        //解析resultMap</span><br><span class="line">        resultMapElements(context.evalNodes(&quot;/mapper/resultMap&quot;));</span><br><span class="line">        //解析sql片段</span><br><span class="line">        sqlElement(context.evalNodes(&quot;/mapper/sql&quot;));</span><br><span class="line">        //解析sql</span><br><span class="line">        buildStatementFromContext(context.evalNodes(&quot;select|insert|update|delete&quot;));</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        throw new BuilderException(&quot;Error parsing Mapper XML. Cause: &quot; + e, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4、XMLMapperBuilder的configurationElement方法"><a href="#4、XMLMapperBuilder的configurationElement方法" class="headerlink" title="4、XMLMapperBuilder的configurationElement方法"></a>4、XMLMapperBuilder的configurationElement方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">private void cacheRefElement(XNode context) &#123;</span><br><span class="line">    if (context != null) &#123;</span><br><span class="line">        //向cacheRefMap中添加命名空间的缓存策略的映射</span><br><span class="line">        configuration.addCacheRef(builderAssistant.getCurrentNamespace(), context.getStringAttribute(&quot;namespace&quot;));</span><br><span class="line">        CacheRefResolver cacheRefResolver = new CacheRefResolver(builderAssistant, context.getStringAttribute(&quot;namespace&quot;));</span><br><span class="line">        try &#123;</span><br><span class="line">            //将引用命名空间的缓存策略，设置到当前命名空间</span><br><span class="line">            cacheRefResolver.resolveCacheRef();</span><br><span class="line">        &#125; catch (IncompleteElementException e) &#123;</span><br><span class="line">            configuration.addIncompleteCacheRef(cacheRefResolver);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>cache-ref配置示例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;cache-ref namespace=&quot;com.mhr.mapper.DemoMapper&quot;/&gt;</span><br></pre></td></tr></table></figure></p>
<h4 id="5、接（二、3）XMLMapperBuilder的cacheElement方法"><a href="#5、接（二、3）XMLMapperBuilder的cacheElement方法" class="headerlink" title="5、接（二、3）XMLMapperBuilder的cacheElement方法"></a>5、接（二、3）XMLMapperBuilder的cacheElement方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">private void cacheElement(XNode context) throws Exception &#123;</span><br><span class="line">    if (context != null) &#123;</span><br><span class="line">        //缓存类型，默认为PERPETUAL,为永久的</span><br><span class="line">        String type = context.getStringAttribute(&quot;type&quot;, &quot;PERPETUAL&quot;);</span><br><span class="line">        Class&lt;? extends Cache&gt; typeClass = typeAliasRegistry.resolveAlias(type);</span><br><span class="line">        //回收策略，LRU,最少使用的被回收 </span><br><span class="line">        String eviction = context.getStringAttribute(&quot;eviction&quot;, &quot;LRU&quot;);</span><br><span class="line">        Class&lt;? extends Cache&gt; evictionClass = typeAliasRegistry.resolveAlias(eviction);</span><br><span class="line">        //刷新缓存间隔</span><br><span class="line">        Long flushInterval = context.getLongAttribute(&quot;flushInterval&quot;);</span><br><span class="line">        //缓存大小</span><br><span class="line">        Integer size = context.getIntAttribute(&quot;size&quot;);</span><br><span class="line">        boolean readWrite = !context.getBooleanAttribute(&quot;readOnly&quot;, false);</span><br><span class="line">        Properties props = context.getChildrenAsProperties();</span><br><span class="line">        //构建一个Cache对象，并加入Configuration</span><br><span class="line">        builderAssistant.useNewCache(typeClass, evictionClass, flushInterval, size, readWrite, props);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>cache配置示例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;cache  </span><br><span class="line">    eviction=&quot;FIFO&quot;  </span><br><span class="line">    flushInterval=&quot;60000&quot;  </span><br><span class="line">    size=&quot;512&quot;  </span><br><span class="line">    readOnly=&quot;true&quot;/&gt;</span><br></pre></td></tr></table></figure></p>
<h4 id="6、MapperBuilderAssistant的useNewCache方法"><a href="#6、MapperBuilderAssistant的useNewCache方法" class="headerlink" title="6、MapperBuilderAssistant的useNewCache方法"></a>6、MapperBuilderAssistant的useNewCache方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public Cache useNewCache(Class&lt;? extends Cache&gt; typeClass,</span><br><span class="line">      Class&lt;? extends Cache&gt; evictionClass,</span><br><span class="line">      Long flushInterval,</span><br><span class="line">      Integer size,</span><br><span class="line">      boolean readWrite,</span><br><span class="line">      Properties props) &#123;</span><br><span class="line">    typeClass = valueOrDefault(typeClass, PerpetualCache.class);</span><br><span class="line">    evictionClass = valueOrDefault(evictionClass, LruCache.class);</span><br><span class="line">    //交由Builder处理,命名空间作为cache的id</span><br><span class="line">    Cache cache = new CacheBuilder(currentNamespace)</span><br><span class="line">        .implementation(typeClass)</span><br><span class="line">        .addDecorator(evictionClass)</span><br><span class="line">        .clearInterval(flushInterval)</span><br><span class="line">        .size(size)</span><br><span class="line">        .readWrite(readWrite)</span><br><span class="line">        .properties(props)</span><br><span class="line">        .build();</span><br><span class="line">    //将cache加入configuration中</span><br><span class="line">    configuration.addCache(cache);</span><br><span class="line">    //设置当前命名空间的缓存，在之后的解析select/update/insert/delete节点设置缓存里使用currentCache</span><br><span class="line">    currentCache = cache;</span><br><span class="line">    return cache;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7、CacheBuilder的build方法"><a href="#7、CacheBuilder的build方法" class="headerlink" title="7、CacheBuilder的build方法"></a>7、CacheBuilder的build方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  public Cache build() &#123;</span><br><span class="line">      setDefaultImplementations();</span><br><span class="line">      //生成基本的Cache实现,默认PerpetualCache</span><br><span class="line">      Cache cache = newBaseCacheInstance(implementation, id);</span><br><span class="line">      setCacheProperties(cache);</span><br><span class="line">      // issue #352, do not apply decorators to custom caches</span><br><span class="line">      if (cache.getClass().getName().startsWith(&quot;org.apache.ibatis&quot;)) &#123;</span><br><span class="line">          //LruCache封装cache</span><br><span class="line">          for (Class&lt;? extends Cache&gt; decorator : decorators) &#123;</span><br><span class="line">              cache = newCacheDecoratorInstance(decorator, cache);</span><br><span class="line">              setCacheProperties(cache);</span><br><span class="line">          &#125;</span><br><span class="line">          //为cache加上一些指定的额外的服务，如、日志及线程安全</span><br><span class="line">          cache = setStandardDecorators(cache);</span><br><span class="line">      &#125;</span><br><span class="line">  return cache;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="8、CacheBuilder的setStandardDecorators方法"><a href="#8、CacheBuilder的setStandardDecorators方法" class="headerlink" title="8、CacheBuilder的setStandardDecorators方法"></a>8、CacheBuilder的setStandardDecorators方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">private Cache setStandardDecorators(Cache cache) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        MetaObject metaCache = SystemMetaObject.forObject(cache);</span><br><span class="line">        if (size != null &amp;&amp; metaCache.hasSetter(&quot;size&quot;)) &#123;</span><br><span class="line">            metaCache.setValue(&quot;size&quot;, size);</span><br><span class="line">        &#125;</span><br><span class="line">        if (clearInterval != null) &#123;</span><br><span class="line">            //ScheduledCache封装cache</span><br><span class="line">            cache = new ScheduledCache(cache);</span><br><span class="line">            ((ScheduledCache) cache).setClearInterval(clearInterval);</span><br><span class="line">        &#125;</span><br><span class="line">        if (readWrite) &#123;</span><br><span class="line">            //SerializedCache封装cache</span><br><span class="line">            cache = new SerializedCache(cache);</span><br><span class="line">        &#125;</span><br><span class="line">        //LoggingCache封装cache</span><br><span class="line">        cache = new LoggingCache(cache);</span><br><span class="line">        //SynchronizedCache封装cache</span><br><span class="line">        cache = new SynchronizedCache(cache);</span><br><span class="line">        return cache;</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        throw new CacheException(&quot;Error building standard cache decorators.  Cause: &quot; + e, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="9、接（二、3）XMLMapperBuilder的resultMapElements方法"><a href="#9、接（二、3）XMLMapperBuilder的resultMapElements方法" class="headerlink" title="9、接（二、3）XMLMapperBuilder的resultMapElements方法"></a>9、接（二、3）XMLMapperBuilder的resultMapElements方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">private void resultMapElements(List&lt;XNode&gt; list) throws Exception &#123;</span><br><span class="line">    for (XNode resultMapNode : list) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            //依次解析mapper节点</span><br><span class="line">            resultMapElement(resultMapNode);</span><br><span class="line">        &#125; catch (IncompleteElementException e) &#123;</span><br><span class="line">            // ignore, it will be retried</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="10、XMLMapperBuilder的resultMapElement方法"><a href="#10、XMLMapperBuilder的resultMapElement方法" class="headerlink" title="10、XMLMapperBuilder的resultMapElement方法"></a>10、XMLMapperBuilder的resultMapElement方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">private ResultMap resultMapElement(XNode resultMapNode, List&lt;ResultMapping&gt; additionalResultMappings) throws Exception &#123;</span><br><span class="line">    ErrorContext.instance().activity(&quot;processing &quot; + resultMapNode.getValueBasedIdentifier());</span><br><span class="line">    //id,对应ResultMap.id,内映射没有ID,用resultMapNode.getValueBasedIdentifier()方法生成一个</span><br><span class="line">    String id = resultMapNode.getStringAttribute(&quot;id&quot;,</span><br><span class="line">        resultMapNode.getValueBasedIdentifier());</span><br><span class="line">    //type,对应ResultMap.Type,这里可以看到这个type可以通过很多个属性进行配置</span><br><span class="line">    String type = resultMapNode.getStringAttribute(&quot;type&quot;,</span><br><span class="line">        resultMapNode.getStringAttribute(&quot;ofType&quot;,</span><br><span class="line">            resultMapNode.getStringAttribute(&quot;resultType&quot;,</span><br><span class="line">                resultMapNode.getStringAttribute(&quot;javaType&quot;))));</span><br><span class="line">    String extend = resultMapNode.getStringAttribute(&quot;extends&quot;);</span><br><span class="line">    //是否自动映射 </span><br><span class="line">    Boolean autoMapping = resultMapNode.getBooleanAttribute(&quot;autoMapping&quot;);</span><br><span class="line">    //将type解析成class,可以是别名，也可以是全限定名</span><br><span class="line">    Class&lt;?&gt; typeClass = resolveClass(type);</span><br><span class="line">    Discriminator discriminator = null;</span><br><span class="line">    //这个resultMappings将对应ResultMap.resultMappings</span><br><span class="line">    List&lt;ResultMapping&gt; resultMappings = new ArrayList&lt;ResultMapping&gt;();</span><br><span class="line">    resultMappings.addAll(additionalResultMappings);</span><br><span class="line">    List&lt;XNode&gt; resultChildren = resultMapNode.getChildren();</span><br><span class="line">    //解析子节点</span><br><span class="line">    for (XNode resultChild : resultChildren) &#123;</span><br><span class="line">        if (&quot;constructor&quot;.equals(resultChild.getName())) &#123;</span><br><span class="line">            //解析constructor节点</span><br><span class="line">            processConstructorElement(resultChild, typeClass, resultMappings);</span><br><span class="line">        &#125; else if (&quot;discriminator&quot;.equals(resultChild.getName())) &#123;</span><br><span class="line">            //解析disriminator节点</span><br><span class="line">            discriminator = processDiscriminatorElement(resultChild, typeClass, resultMappings);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            ArrayList&lt;ResultFlag&gt; flags = new ArrayList&lt;ResultFlag&gt;();</span><br><span class="line">            if (&quot;id&quot;.equals(resultChild.getName())) &#123;</span><br><span class="line">                flags.add(ResultFlag.ID);</span><br><span class="line">            &#125;</span><br><span class="line">            //解析其他节点,主要有result、association及collection  </span><br><span class="line">            //在这里可以说明一个result、association及collection都会被解析成一个resultMapping对象，即使他们有很多子元素  </span><br><span class="line">            resultMappings.add(buildResultMappingFromContext(resultChild, typeClass, flags));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ResultMapResolver resultMapResolver = new ResultMapResolver(builderAssistant, id, typeClass, extend, discriminator, resultMappings, </span><br><span class="line">        autoMapping);</span><br><span class="line">    try &#123;</span><br><span class="line">        //得到resultMappings后，生成ResultMap并加入到Configuration中</span><br><span class="line">        return resultMapResolver.resolve();</span><br><span class="line">    &#125; catch (IncompleteElementException  e) &#123;</span><br><span class="line">        configuration.addIncompleteResultMap(resultMapResolver);</span><br><span class="line">        throw e;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>resultMap配置示例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap id=&quot;Employee&quot; type=&quot;Demo&quot;&gt;  </span><br><span class="line">    &lt;id property=&quot;id&quot; column=&quot;id&quot; /&gt;  </span><br><span class="line">    &lt;result property=&quot;name&quot; column=&quot;name&quot; /&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br></pre></td></tr></table></figure></p>
<h4 id="11、XMLMapperBuilder的processConstructorElement方法"><a href="#11、XMLMapperBuilder的processConstructorElement方法" class="headerlink" title="11、XMLMapperBuilder的processConstructorElement方法"></a>11、XMLMapperBuilder的processConstructorElement方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">private void processConstructorElement(XNode resultChild, Class&lt;?&gt; resultType, List&lt;ResultMapping&gt; resultMappings) throws Exception &#123;</span><br><span class="line">    List&lt;XNode&gt; argChildren = resultChild.getChildren();</span><br><span class="line">    //遍历子节点 </span><br><span class="line">    for (XNode argChild : argChildren) &#123;</span><br><span class="line">        ArrayList&lt;ResultFlag&gt; flags = new ArrayList&lt;ResultFlag&gt;();</span><br><span class="line">        //标识为ResultFlag.CONSTRUCTOR </span><br><span class="line">        flags.add(ResultFlag.CONSTRUCTOR);</span><br><span class="line">        if (&quot;idArg&quot;.equals(argChild.getName())) &#123;</span><br><span class="line">            //标识为一个ID属性 </span><br><span class="line">            flags.add(ResultFlag.ID);</span><br><span class="line">        &#125;</span><br><span class="line">        //创建一个ResultMapping对象，并加入resultMappings  </span><br><span class="line">        //这里说明了，constructor下有多个几子节点，就会产生多少个resultMapping对象</span><br><span class="line">        resultMappings.add(buildResultMappingFromContext(argChild, resultType, flags));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="12、XMLMapperBuilder的buildResultMappingFromContext方法"><a href="#12、XMLMapperBuilder的buildResultMappingFromContext方法" class="headerlink" title="12、XMLMapperBuilder的buildResultMappingFromContext方法"></a>12、XMLMapperBuilder的buildResultMappingFromContext方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">private ResultMapping buildResultMappingFromContext(XNode context, Class&lt;?&gt; resultType, ArrayList&lt;ResultFlag&gt; flags) throws Exception &#123;</span><br><span class="line">    String property = context.getStringAttribute(&quot;property&quot;);</span><br><span class="line">    String column = context.getStringAttribute(&quot;column&quot;);</span><br><span class="line">    String javaType = context.getStringAttribute(&quot;javaType&quot;);</span><br><span class="line">    String jdbcType = context.getStringAttribute(&quot;jdbcType&quot;);</span><br><span class="line">    String nestedSelect = context.getStringAttribute(&quot;select&quot;);</span><br><span class="line">    //这里需要特殊说明，一个resultMapping可以对应一个resultMap对应，我们称之为内部映射 </span><br><span class="line">    String nestedResultMap = context.getStringAttribute(&quot;resultMap&quot;,</span><br><span class="line">        processNestedResultMappings(context, Collections.&lt;ResultMapping&gt; emptyList()));</span><br><span class="line">    String notNullColumn = context.getStringAttribute(&quot;notNullColumn&quot;);</span><br><span class="line">    String columnPrefix = context.getStringAttribute(&quot;columnPrefix&quot;);</span><br><span class="line">    String typeHandler = context.getStringAttribute(&quot;typeHandler&quot;);</span><br><span class="line">    String resulSet = context.getStringAttribute(&quot;resultSet&quot;);</span><br><span class="line">    String foreignColumn = context.getStringAttribute(&quot;foreignColumn&quot;);</span><br><span class="line">    Class&lt;?&gt; javaTypeClass = resolveClass(javaType);</span><br><span class="line">    @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">    Class&lt;? extends TypeHandler&lt;?&gt;&gt; typeHandlerClass = (Class&lt;? extends TypeHandler&lt;?&gt;&gt;) resolveClass(typeHandler);</span><br><span class="line">    JdbcType jdbcTypeEnum = resolveJdbcType(jdbcType);</span><br><span class="line">    //这里的ResultMapping生成的方法跟ResultMap生成的过程大同小异</span><br><span class="line">    return builderAssistant.buildResultMapping(resultType, property, column, javaTypeClass, jdbcTypeEnum, nestedSelect, nestedResultMap,    </span><br><span class="line">        notNullColumn, columnPrefix, typeHandlerClass, flags, resulSet, foreignColumn);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="13、XMLMapperBuilder的processNestedResultMappings方法"><a href="#13、XMLMapperBuilder的processNestedResultMappings方法" class="headerlink" title="13、XMLMapperBuilder的processNestedResultMappings方法"></a>13、XMLMapperBuilder的processNestedResultMappings方法</h4><p>生成一个内部的ReulstMapp对象<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">private String processNestedResultMappings(XNode context, List&lt;ResultMapping&gt; resultMappings) throws Exception &#123;</span><br><span class="line">    //只有association, collection, case节点才会生成内部映射，其他不生成，返回null</span><br><span class="line">    if (&quot;association&quot;.equals(context.getName())</span><br><span class="line">          || &quot;collection&quot;.equals(context.getName())</span><br><span class="line">          || &quot;case&quot;.equals(context.getName())) &#123;</span><br><span class="line">        if (context.getStringAttribute(&quot;select&quot;) == null) &#123;</span><br><span class="line">            //这里类似一个递归调用，需要注意内部映射的ID是Mybatis自动生成的，不是在配置文件里读取的</span><br><span class="line">            ResultMap resultMap = resultMapElement(context, resultMappings);</span><br><span class="line">            return resultMap.getId();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="14、接（二、10）ResultMapResolver的resolve方法"><a href="#14、接（二、10）ResultMapResolver的resolve方法" class="headerlink" title="14、接（二、10）ResultMapResolver的resolve方法"></a>14、接（二、10）ResultMapResolver的resolve方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public ResultMap resolve() &#123;</span><br><span class="line">    return assistant.addResultMap(this.id, this.type, this.extend, this.discriminator, this.resultMappings, this.autoMapping);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="15、MapperBuilderAssistant的addResultMap方法"><a href="#15、MapperBuilderAssistant的addResultMap方法" class="headerlink" title="15、MapperBuilderAssistant的addResultMap方法"></a>15、MapperBuilderAssistant的addResultMap方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"> public ResultMap addResultMap(</span><br><span class="line">       String id,</span><br><span class="line">       Class&lt;?&gt; type,</span><br><span class="line">       String extend,</span><br><span class="line">       Discriminator discriminator,</span><br><span class="line">       List&lt;ResultMapping&gt; resultMappings,</span><br><span class="line">       Boolean autoMapping) &#123;</span><br><span class="line">//没有命名空间，则添加当前命名空间，false时检查命名空间是否是当前命名空间</span><br><span class="line">         id = applyCurrentNamespace(id, false);</span><br><span class="line">//没有命名空间，则添加当前命名空间</span><br><span class="line">         extend = applyCurrentNamespace(extend, true);</span><br><span class="line">         //交由ResultMap.Builder来创建ResultMap对象，ResultMap.Builder.build()方法前面已经介绍过</span><br><span class="line">         ResultMap.Builder resultMapBuilder = new ResultMap.Builder(configuration, id, type, resultMappings, autoMapping);</span><br><span class="line">     if (extend != null) &#123;</span><br><span class="line">         //对继承了其他resultMap的处理</span><br><span class="line">         if (!configuration.hasResultMap(extend)) &#123;</span><br><span class="line">             throw new IncompleteElementException(&quot;Could not find a parent resultmap with id &apos;&quot; + extend + &quot;&apos;&quot;);</span><br><span class="line">         &#125;</span><br><span class="line">         ResultMap resultMap = configuration.getResultMap(extend);</span><br><span class="line">         List&lt;ResultMapping&gt; extendedResultMappings = new ArrayList&lt;ResultMapping&gt;(resultMap.getResultMappings());</span><br><span class="line">         extendedResultMappings.removeAll(resultMappings);</span><br><span class="line">         // Remove parent constructor if this resultMap declares a constructor.</span><br><span class="line">         boolean declaresConstructor = false;</span><br><span class="line">         for (ResultMapping resultMapping : resultMappings) &#123;</span><br><span class="line">             if (resultMapping.getFlags().contains(ResultFlag.CONSTRUCTOR)) &#123;</span><br><span class="line">                 declaresConstructor = true;</span><br><span class="line">                 break;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         if (declaresConstructor) &#123;</span><br><span class="line">             Iterator&lt;ResultMapping&gt; extendedResultMappingsIter = extendedResultMappings.iterator();</span><br><span class="line">             while (extendedResultMappingsIter.hasNext()) &#123;</span><br><span class="line">                 if (extendedResultMappingsIter.next().getFlags().contains(ResultFlag.CONSTRUCTOR)) &#123;</span><br><span class="line">                     extendedResultMappingsIter.remove();</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         resultMappings.addAll(extendedResultMappings);</span><br><span class="line">     &#125;</span><br><span class="line">     resultMapBuilder.discriminator(discriminator);</span><br><span class="line">     //生成ResultMap对象</span><br><span class="line">     ResultMap resultMap = resultMapBuilder.build();</span><br><span class="line">     //另到Configuration中</span><br><span class="line">     configuration.addResultMap(resultMap);</span><br><span class="line">     return resultMap;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="16、接（二、3）XMLMapperBuilder的sqlElement方法"><a href="#16、接（二、3）XMLMapperBuilder的sqlElement方法" class="headerlink" title="16、接（二、3）XMLMapperBuilder的sqlElement方法"></a>16、接（二、3）XMLMapperBuilder的sqlElement方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">private void sqlElement(List&lt;XNode&gt; list, String requiredDatabaseId) throws Exception &#123;</span><br><span class="line">    for (XNode context : list) &#123;</span><br><span class="line">        String databaseId = context.getStringAttribute(&quot;databaseId&quot;);</span><br><span class="line">        String id = context.getStringAttribute(&quot;id&quot;);</span><br><span class="line">        //没有命名空间，则添加命名空间，false时检查命名空间是否是当前命名空间</span><br><span class="line">        id = builderAssistant.applyCurrentNamespace(id, false);</span><br><span class="line">        if (databaseIdMatchesCurrent(id, databaseId, requiredDatabaseId)) </span><br><span class="line">            //sql片段加入sqlFragments</span><br><span class="line">            sqlFragments.put(id, context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>sql配置示例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;sql id=&quot;sql_select&quot;&gt; </span><br><span class="line">    SELECT * FROM BLOG </span><br><span class="line">    WHERE 1=1 </span><br><span class="line">    &lt;if test=&quot;id!= null and title!=null&quot;&gt;</span><br><span class="line">        AND id=#&#123;id&#125; and title=#&#123;title&#125;</span><br><span class="line">    &lt;/if&gt; </span><br><span class="line">&lt;/sql&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="三、sql加载过程"><a href="#三、sql加载过程" class="headerlink" title="三、sql加载过程"></a>三、sql加载过程</h3><h4 id="1、接（二、3）XMLMapperBuilder的buildStatementFromContext方法"><a href="#1、接（二、3）XMLMapperBuilder的buildStatementFromContext方法" class="headerlink" title="1、接（二、3）XMLMapperBuilder的buildStatementFromContext方法"></a>1、接（二、3）XMLMapperBuilder的buildStatementFromContext方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">private void buildStatementFromContext(List&lt;XNode&gt; list, String requiredDatabaseId) &#123;</span><br><span class="line">    for (XNode context : list) &#123;</span><br><span class="line">        //一个select/update/insert/delete元素创建一个XMLStatementBuilder对象 </span><br><span class="line">        final XMLStatementBuilder statementParser = new XMLStatementBuilder(configuration, builderAssistant, context, </span><br><span class="line">              requiredDatabaseId);</span><br><span class="line">        try &#123;</span><br><span class="line">            //将元素解析成MappedStatemenet对象，并加入到Configuration中去</span><br><span class="line">            statementParser.parseStatementNode();</span><br><span class="line">        &#125; catch (IncompleteElementException e) &#123;</span><br><span class="line">            configuration.addIncompleteStatement(statementParser);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2、XMLStatementBuilder的parseStatementNode方法"><a href="#2、XMLStatementBuilder的parseStatementNode方法" class="headerlink" title="2、XMLStatementBuilder的parseStatementNode方法"></a>2、XMLStatementBuilder的parseStatementNode方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">public void parseStatementNode() &#123;</span><br><span class="line">    String id = context.getStringAttribute(&quot;id&quot;);</span><br><span class="line">    String databaseId = context.getStringAttribute(&quot;databaseId&quot;);</span><br><span class="line"></span><br><span class="line">    if (!databaseIdMatchesCurrent(id, databaseId, this.requiredDatabaseId)) return;</span><br><span class="line"></span><br><span class="line">    Integer fetchSize = context.getIntAttribute(&quot;fetchSize&quot;);</span><br><span class="line">    Integer timeout = context.getIntAttribute(&quot;timeout&quot;);</span><br><span class="line">    String parameterMap = context.getStringAttribute(&quot;parameterMap&quot;);</span><br><span class="line">    //参数类</span><br><span class="line">    String parameterType = context.getStringAttribute(&quot;parameterType&quot;);</span><br><span class="line">    Class&lt;?&gt; parameterTypeClass = resolveClass(parameterType);</span><br><span class="line">    //返回结果映射</span><br><span class="line">    String resultMap = context.getStringAttribute(&quot;resultMap&quot;);</span><br><span class="line">    //返回结果类</span><br><span class="line">    String resultType = context.getStringAttribute(&quot;resultType&quot;);</span><br><span class="line">    String lang = context.getStringAttribute(&quot;lang&quot;);</span><br><span class="line">    LanguageDriver langDriver = getLanguageDriver(lang);</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt; resultTypeClass = resolveClass(resultType);</span><br><span class="line">    String resultSetType = context.getStringAttribute(&quot;resultSetType&quot;);</span><br><span class="line">    //Statement的类型，对应jdbc里的三个类型:Statement、PreparedStatement、CallableStatement，默认使用PreparedStatement</span><br><span class="line">    StatementType statementType = StatementType.valueOf(context.getStringAttribute(&quot;statementType&quot;, StatementType.PREPARED.toString()));</span><br><span class="line">    //这个也是跟jdbc里相对应的，一般采用默认即可</span><br><span class="line">    ResultSetType resultSetTypeEnum = resolveResultSetType(resultSetType);</span><br><span class="line"></span><br><span class="line">    //Sql的类型，select/update/insert/delete</span><br><span class="line">    String nodeName = context.getNode().getNodeName();</span><br><span class="line">    SqlCommandType sqlCommandType = SqlCommandType.valueOf(nodeName.toUpperCase(Locale.ENGLISH));</span><br><span class="line">    boolean isSelect = sqlCommandType == SqlCommandType.SELECT;</span><br><span class="line">    //是否刷新缓存</span><br><span class="line">    boolean flushCache = context.getBooleanAttribute(&quot;flushCache&quot;, !isSelect);</span><br><span class="line">    //是否使用缓存</span><br><span class="line">    boolean useCache = context.getBooleanAttribute(&quot;useCache&quot;, isSelect);</span><br><span class="line">    boolean resultOrdered = context.getBooleanAttribute(&quot;resultOrdered&quot;, false);</span><br><span class="line"></span><br><span class="line">    // Include Fragments before parsing</span><br><span class="line">    XMLIncludeTransformer includeParser = new XMLIncludeTransformer(configuration, builderAssistant);</span><br><span class="line">    //包含sql片段，把sql片段替换进来</span><br><span class="line">    includeParser.applyIncludes(context.getNode());</span><br><span class="line"></span><br><span class="line">    //selectKey生成id</span><br><span class="line">    //Parse selectKey after includes,in case if IncompleteElementException (issue #291)</span><br><span class="line">    List&lt;XNode&gt; selectKeyNodes = context.evalNodes(&quot;selectKey&quot;);</span><br><span class="line">    if (configuration.getDatabaseId() != null) &#123;</span><br><span class="line">        parseSelectKeyNodes(id, selectKeyNodes, parameterTypeClass, langDriver, configuration.getDatabaseId());</span><br><span class="line">    &#125;</span><br><span class="line">    parseSelectKeyNodes(id, selectKeyNodes, parameterTypeClass, langDriver, null);</span><br><span class="line"></span><br><span class="line">    //XMLLanguageDriver创建sqlSource</span><br><span class="line">    // Parse the SQL (pre: &lt;selectKey&gt; and &lt;include&gt; were parsed and removed)</span><br><span class="line">    SqlSource sqlSource = langDriver.createSqlSource(configuration, context, parameterTypeClass);</span><br><span class="line">    String resultSets = context.getStringAttribute(&quot;resultSets&quot;);</span><br><span class="line">    String keyProperty = context.getStringAttribute(&quot;keyProperty&quot;);</span><br><span class="line">    String keyColumn = context.getStringAttribute(&quot;keyColumn&quot;);</span><br><span class="line">    //自动生成key</span><br><span class="line">    KeyGenerator keyGenerator;</span><br><span class="line">    String keyStatementId = id + SelectKeyGenerator.SELECT_KEY_SUFFIX;</span><br><span class="line">    //没有命名空间，则添加当前命名空间</span><br><span class="line">    keyStatementId = builderAssistant.applyCurrentNamespace(keyStatementId, true);</span><br><span class="line">    if (configuration.hasKeyGenerator(keyStatementId)) &#123;</span><br><span class="line">        //获取刚刚创建的id生成器</span><br><span class="line">        keyGenerator = configuration.getKeyGenerator(keyStatementId);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        //没有selectKey，配置了useGeneratedKeys且为insert，则用Jdbc3KeyGenerator生成器</span><br><span class="line">        keyGenerator = context.getBooleanAttribute(&quot;useGeneratedKeys&quot;,</span><br><span class="line">              configuration.isUseGeneratedKeys() &amp;&amp; SqlCommandType.INSERT.equals(sqlCommandType))</span><br><span class="line">              ? new Jdbc3KeyGenerator() : new NoKeyGenerator();</span><br><span class="line">    &#125;</span><br><span class="line">    //生成MappedStatement对象，并加到Configuration中  </span><br><span class="line">    builderAssistant.addMappedStatement(id, sqlSource, statementType, sqlCommandType,</span><br><span class="line">          fetchSize, timeout, parameterMap, parameterTypeClass, resultMap, resultTypeClass,</span><br><span class="line">          resultSetTypeEnum, flushCache, useCache, resultOrdered, </span><br><span class="line">          keyGenerator, keyProperty, keyColumn, databaseId, langDriver, resultSets);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3、XMLIncludeTransformer的applyIncludes方法"><a href="#3、XMLIncludeTransformer的applyIncludes方法" class="headerlink" title="3、XMLIncludeTransformer的applyIncludes方法"></a>3、XMLIncludeTransformer的applyIncludes方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">public void applyIncludes(Node source) &#123;</span><br><span class="line">    //source为sql片段</span><br><span class="line">    if (source.getNodeName().equals(&quot;include&quot;)) &#123;</span><br><span class="line">        //由refid获取sql片段</span><br><span class="line">        Node toInclude = findSqlFragment(getStringAttribute(source, &quot;refid&quot;));</span><br><span class="line">        //若sql片段中包含sql片段，继续解析</span><br><span class="line">        applyIncludes(toInclude);</span><br><span class="line">        if (toInclude.getOwnerDocument() != source.getOwnerDocument()) &#123;</span><br><span class="line">            toInclude = source.getOwnerDocument().importNode(toInclude, true);</span><br><span class="line">        &#125;</span><br><span class="line">        //用获取的sql片段替换本节点</span><br><span class="line">        source.getParentNode().replaceChild(toInclude, source);</span><br><span class="line">        while (toInclude.hasChildNodes()) &#123;</span><br><span class="line">            toInclude.getParentNode().insertBefore(toInclude.getFirstChild(), toInclude);</span><br><span class="line">        &#125;</span><br><span class="line">        toInclude.getParentNode().removeChild(toInclude);</span><br><span class="line">    &#125; else if (source.getNodeType() == Node.ELEMENT_NODE) &#123;</span><br><span class="line">        //source为节点列表</span><br><span class="line">        NodeList children = source.getChildNodes();</span><br><span class="line">        for (int i=0; i&lt;children.getLength(); i++) &#123;</span><br><span class="line">            applyIncludes(children.item(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4、XMLIncludeTransformer的findSqlFragment方法"><a href="#4、XMLIncludeTransformer的findSqlFragment方法" class="headerlink" title="4、XMLIncludeTransformer的findSqlFragment方法"></a>4、XMLIncludeTransformer的findSqlFragment方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">   private Node findSqlFragment(String refid) &#123;</span><br><span class="line">	refid = PropertyParser.parse(refid, configuration.getVariables());</span><br><span class="line">	//没有命名空间，则添加当前命名空间</span><br><span class="line">	refid = builderAssistant.applyCurrentNamespace(refid, true);</span><br><span class="line">	try &#123;</span><br><span class="line">	  //获取sql片段，必须是在同一个命名空间下</span><br><span class="line">	  XNode nodeToInclude = configuration.getSqlFragments().get(refid);</span><br><span class="line">	  Node result = nodeToInclude.getNode().cloneNode(true);</span><br><span class="line">	  return result;</span><br><span class="line">	&#125; catch (IllegalArgumentException e) &#123;</span><br><span class="line">	  throw new IncompleteElementException(&quot;Could not find SQL statement to include with refid &apos;&quot; + refid + &quot;&apos;&quot;, e);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5、接（三、2）XMLStatementBuilder的parseSelectKeyNodes方法"><a href="#5、接（三、2）XMLStatementBuilder的parseSelectKeyNodes方法" class="headerlink" title="5、接（三、2）XMLStatementBuilder的parseSelectKeyNodes方法"></a>5、接（三、2）XMLStatementBuilder的parseSelectKeyNodes方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public void parseSelectKeyNodes(String parentId, List&lt;XNode&gt; list, Class&lt;?&gt; parameterTypeClass, LanguageDriver </span><br><span class="line">      langDriver, String skRequiredDatabaseId) &#123;</span><br><span class="line">    for (XNode nodeToHandle : list) &#123;</span><br><span class="line">        String id = parentId + SelectKeyGenerator.SELECT_KEY_SUFFIX;</span><br><span class="line">        String databaseId = nodeToHandle.getStringAttribute(&quot;databaseId&quot;);</span><br><span class="line">        if (databaseIdMatchesCurrent(id, databaseId, skRequiredDatabaseId)) &#123;</span><br><span class="line">            parseSelectKeyNode(id, nodeToHandle, parameterTypeClass, langDriver, databaseId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>selectKey配置示例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;insert id=&quot;insert&quot;&gt;</span><br><span class="line">    &lt;selectKey keyProperty=&quot;id&quot; resultType=&quot;int&quot; order=&quot;BEFORE&quot;&gt;</span><br><span class="line">        &lt;if test=&quot;_databaseId == &apos;oracle&apos;&quot;&gt;</span><br><span class="line">            select seq_users.nextval from dual</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">        &lt;if test=&quot;_databaseId == &apos;db2&apos;&quot;&gt;</span><br><span class="line">            select nextval for seq_users from sysibm.sysdummy1&quot;</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">    &lt;/selectKey&gt;</span><br><span class="line">    insert into users values (#&#123;id&#125;, #&#123;name&#125;)</span><br><span class="line">&lt;/insert&gt;</span><br></pre></td></tr></table></figure></p>
<h4 id="6、XMLStatementBuilder的parseSelectKeyNodes方法"><a href="#6、XMLStatementBuilder的parseSelectKeyNodes方法" class="headerlink" title="6、XMLStatementBuilder的parseSelectKeyNodes方法"></a>6、XMLStatementBuilder的parseSelectKeyNodes方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">public void parseSelectKeyNode(String id, XNode nodeToHandle, Class&lt;?&gt; parameterTypeClass, LanguageDriver langDriver, </span><br><span class="line">      String databaseId) &#123;</span><br><span class="line">    //返回类型</span><br><span class="line">    String resultType = nodeToHandle.getStringAttribute(&quot;resultType&quot;);</span><br><span class="line">    Class&lt;?&gt; resultTypeClass = resolveClass(resultType);</span><br><span class="line">    //Statement的类型，对应jdbc里的三个类型:Statement、PreparedStatement、CallableStatement，默认使用PreparedStatement </span><br><span class="line">    StatementType statementType = StatementType.valueOf(nodeToHandle.getStringAttribute(&quot;statementType&quot;, </span><br><span class="line">          StatementType.PREPARED.toString()));</span><br><span class="line">    //属性名</span><br><span class="line">    String keyProperty = nodeToHandle.getStringAttribute(&quot;keyProperty&quot;);</span><br><span class="line">    boolean executeBefore = &quot;BEFORE&quot;.equals(nodeToHandle.getStringAttribute(&quot;order&quot;, &quot;AFTER&quot;));</span><br><span class="line"></span><br><span class="line">    //defaults</span><br><span class="line">    boolean useCache = false;</span><br><span class="line">    boolean resultOrdered = false;</span><br><span class="line">    //主键生成器</span><br><span class="line">    KeyGenerator keyGenerator = new NoKeyGenerator();</span><br><span class="line">    Integer fetchSize = null;</span><br><span class="line">    Integer timeout = null;</span><br><span class="line">    boolean flushCache = false;</span><br><span class="line">    String parameterMap = null;</span><br><span class="line">    String resultMap = null;</span><br><span class="line">    ResultSetType resultSetTypeEnum = null;</span><br><span class="line">    //XMLLanguageDriver创建sqlSource</span><br><span class="line">    SqlSource sqlSource = langDriver.createSqlSource(configuration, nodeToHandle, parameterTypeClass);</span><br><span class="line">    SqlCommandType sqlCommandType = SqlCommandType.SELECT;</span><br><span class="line"></span><br><span class="line">    //生成MappedStatement对象，并加到Configuration中</span><br><span class="line">    builderAssistant.addMappedStatement(id, sqlSource, statementType, sqlCommandType,</span><br><span class="line">          fetchSize, timeout, parameterMap, parameterTypeClass, resultMap, resultTypeClass,</span><br><span class="line">          resultSetTypeEnum, flushCache, useCache, resultOrdered,</span><br><span class="line">          keyGenerator, keyProperty, null, databaseId, langDriver, null);</span><br><span class="line">    //没有命名空间，则添加当前命名空间，false时检查命名空间是否是当前命名空间</span><br><span class="line">    id = builderAssistant.applyCurrentNamespace(id, false);</span><br><span class="line">    //获取刚刚保存得，该selectKey的MappedStatement</span><br><span class="line">    MappedStatement keyStatement = configuration.getMappedStatement(id, false);</span><br><span class="line">    //创建id生成器，加入configuration中</span><br><span class="line">    configuration.addKeyGenerator(id, new SelectKeyGenerator(keyStatement, executeBefore));</span><br><span class="line">    //处理完，删掉本节点</span><br><span class="line">    nodeToHandle.getParent().getNode().removeChild(nodeToHandle.getNode());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7、XMLLanguageDriver的createSqlSource方法"><a href="#7、XMLLanguageDriver的createSqlSource方法" class="headerlink" title="7、XMLLanguageDriver的createSqlSource方法"></a>7、XMLLanguageDriver的createSqlSource方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public SqlSource createSqlSource(Configuration configuration, XNode script, Class&lt;?&gt; parameterType) &#123;</span><br><span class="line">    XMLScriptBuilder builder = new XMLScriptBuilder(configuration, script);</span><br><span class="line">    return builder.parseScriptNode();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="8、XMLScriptBuilder的parseScriptNode方法"><a href="#8、XMLScriptBuilder的parseScriptNode方法" class="headerlink" title="8、XMLScriptBuilder的parseScriptNode方法"></a>8、XMLScriptBuilder的parseScriptNode方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  public SqlSource parseScriptNode() &#123;</span><br><span class="line">      //解析sql</span><br><span class="line">      List&lt;SqlNode&gt; contents = parseDynamicTags(context);</span><br><span class="line">      //混合sql节点</span><br><span class="line">      MixedSqlNode rootSqlNode = new MixedSqlNode(contents);</span><br><span class="line">//默认动态sql</span><br><span class="line">      SqlSource sqlSource = new DynamicSqlSource(configuration, rootSqlNode);</span><br><span class="line">      return sqlSource;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="9、XMLScriptBuilder的parseDynamicTags方法"><a href="#9、XMLScriptBuilder的parseDynamicTags方法" class="headerlink" title="9、XMLScriptBuilder的parseDynamicTags方法"></a>9、XMLScriptBuilder的parseDynamicTags方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">private List&lt;SqlNode&gt; parseDynamicTags(XNode node) &#123;</span><br><span class="line">    //一个sql会被解析成多个SqlNode</span><br><span class="line">    List&lt;SqlNode&gt; contents = new ArrayList&lt;SqlNode&gt;();</span><br><span class="line">    NodeList children = node.getNode().getChildNodes();</span><br><span class="line">    for (int i = 0; i &lt; children.getLength(); i++) &#123;</span><br><span class="line">        XNode child = node.newXNode(children.item(i));</span><br><span class="line">        String nodeName = child.getNode().getNodeName();</span><br><span class="line">        if (child.getNode().getNodeType() == Node.CDATA_SECTION_NODE</span><br><span class="line">              || child.getNode().getNodeType() == Node.TEXT_NODE) &#123;</span><br><span class="line">            //如果这个Node只包含文本  </span><br><span class="line">            String data = child.getStringBody(&quot;&quot;);</span><br><span class="line">            //生成一个TextSqlNode </span><br><span class="line">            contents.add(new TextSqlNode(data));</span><br><span class="line">        &#125; else if (child.getNode().getNodeType() == Node.ELEMENT_NODE &amp;&amp; !&quot;selectKey&quot;.equals(nodeName)) &#123; </span><br><span class="line">            //如果是有xml标签的Node,交由Handler处理，同时被认为是动态的</span><br><span class="line">            NodeHandler handler = nodeHandlers.get(nodeName);</span><br><span class="line">            if (handler == null) &#123;</span><br><span class="line">                throw new BuilderException(&quot;Unknown element &lt;&quot; + nodeName + &quot;&gt; in SQL statement.&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            //处理该标签</span><br><span class="line">            handler.handleNode(child, contents);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return contents;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="10、If标签处理器"><a href="#10、If标签处理器" class="headerlink" title="10、If标签处理器"></a>10、If标签处理器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;  </span><br><span class="line">    //Mybatis3动态sql都支持那些配置，这里就很清楚啦  </span><br><span class="line">    put(&quot;trim&quot;, new TrimHandler());  </span><br><span class="line">    put(&quot;where&quot;, new WhereHandler());  </span><br><span class="line">    put(&quot;set&quot;, new SetHandler());  </span><br><span class="line">    put(&quot;foreach&quot;, new ForEachHandler());  </span><br><span class="line">    put(&quot;if&quot;, new IfHandler());  </span><br><span class="line">    put(&quot;choose&quot;, new ChooseHandler());  </span><br><span class="line">    put(&quot;when&quot;, new IfHandler());  </span><br><span class="line">    put(&quot;otherwise&quot;, new OtherwiseHandler());  </span><br><span class="line">    put(&quot;bind&quot;, new BindHandler());  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">private class IfHandler implements NodeHandler &#123;</span><br><span class="line">    public void handleNode(XNode nodeToHandle, List&lt;SqlNode&gt; targetContents) &#123;</span><br><span class="line">        //解析if标签下的节点</span><br><span class="line">        List&lt;SqlNode&gt; contents = parseDynamicTags(nodeToHandle);</span><br><span class="line">        //创建组合节点</span><br><span class="line">        MixedSqlNode mixedSqlNode = new MixedSqlNode(contents);</span><br><span class="line">        String test = nodeToHandle.getStringAttribute(&quot;test&quot;);</span><br><span class="line">        //创建if节点</span><br><span class="line">        IfSqlNode ifSqlNode = new IfSqlNode(mixedSqlNode, test);</span><br><span class="line">        targetContents.add(ifSqlNode);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>mybatis3的配置文件加载到此就结束了</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/04/20/mybatis3源码/mybatis源码sql执行过程（2）/" rel="next" title="mybatis源码sql执行过程（2）">
                <i class="fa fa-chevron-left"></i> mybatis源码sql执行过程（2）
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/05/06/JUC源码/JUC原子类 /" rel="prev" title="JUC原子类">
                JUC原子类 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Inhaltsverzeichnis
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Übersicht
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">John Doe</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">25</span>
                  <span class="site-state-item-name">Artikel</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">Kategorien</span>
                
              </div>
            

            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#mybatis源码配置文件加载过程"><span class="nav-number">1.</span> <span class="nav-text">mybatis源码配置文件加载过程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#mybatis-Demo"><span class="nav-number">1.1.</span> <span class="nav-text">mybatis Demo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#一、属性和别名加载过程"><span class="nav-number">1.2.</span> <span class="nav-text">一、属性和别名加载过程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1、SqlSessionFactoryBuilder的build方法"><span class="nav-number">1.2.1.</span> <span class="nav-text">1、SqlSessionFactoryBuilder的build方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2、XMLConfigBuilder的parse方法"><span class="nav-number">1.2.2.</span> <span class="nav-text">2、XMLConfigBuilder的parse方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3、XMLConfigBuilder的parseConfiguration方法"><span class="nav-number">1.2.3.</span> <span class="nav-text">3、XMLConfigBuilder的parseConfiguration方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4、XMLConfigBuilder的propertiesElement方法"><span class="nav-number">1.2.4.</span> <span class="nav-text">4、XMLConfigBuilder的propertiesElement方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5、接（一、3）XMLConfigBuilder的typeAliasesElement方法"><span class="nav-number">1.2.5.</span> <span class="nav-text">5、接（一、3）XMLConfigBuilder的typeAliasesElement方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6、实例化TypeAliasRegistry"><span class="nav-number">1.2.6.</span> <span class="nav-text">6、实例化TypeAliasRegistry</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7、接（一、3）XMLConfigBuilder的environmentsElement方法"><span class="nav-number">1.2.7.</span> <span class="nav-text">7、接（一、3）XMLConfigBuilder的environmentsElement方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二、mapper文件加载过程"><span class="nav-number">1.3.</span> <span class="nav-text">二、mapper文件加载过程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1、接（一、3）XMLConfigBuilder的mapperElement方法"><span class="nav-number">1.3.1.</span> <span class="nav-text">1、接（一、3）XMLConfigBuilder的mapperElement方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2、XMLMapperBuilder的parse方法"><span class="nav-number">1.3.2.</span> <span class="nav-text">2、XMLMapperBuilder的parse方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3、XMLMapperBuilder的configurationElement方法"><span class="nav-number">1.3.3.</span> <span class="nav-text">3、XMLMapperBuilder的configurationElement方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4、XMLMapperBuilder的configurationElement方法"><span class="nav-number">1.3.4.</span> <span class="nav-text">4、XMLMapperBuilder的configurationElement方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5、接（二、3）XMLMapperBuilder的cacheElement方法"><span class="nav-number">1.3.5.</span> <span class="nav-text">5、接（二、3）XMLMapperBuilder的cacheElement方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6、MapperBuilderAssistant的useNewCache方法"><span class="nav-number">1.3.6.</span> <span class="nav-text">6、MapperBuilderAssistant的useNewCache方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7、CacheBuilder的build方法"><span class="nav-number">1.3.7.</span> <span class="nav-text">7、CacheBuilder的build方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8、CacheBuilder的setStandardDecorators方法"><span class="nav-number">1.3.8.</span> <span class="nav-text">8、CacheBuilder的setStandardDecorators方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9、接（二、3）XMLMapperBuilder的resultMapElements方法"><span class="nav-number">1.3.9.</span> <span class="nav-text">9、接（二、3）XMLMapperBuilder的resultMapElements方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10、XMLMapperBuilder的resultMapElement方法"><span class="nav-number">1.3.10.</span> <span class="nav-text">10、XMLMapperBuilder的resultMapElement方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11、XMLMapperBuilder的processConstructorElement方法"><span class="nav-number">1.3.11.</span> <span class="nav-text">11、XMLMapperBuilder的processConstructorElement方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#12、XMLMapperBuilder的buildResultMappingFromContext方法"><span class="nav-number">1.3.12.</span> <span class="nav-text">12、XMLMapperBuilder的buildResultMappingFromContext方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#13、XMLMapperBuilder的processNestedResultMappings方法"><span class="nav-number">1.3.13.</span> <span class="nav-text">13、XMLMapperBuilder的processNestedResultMappings方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#14、接（二、10）ResultMapResolver的resolve方法"><span class="nav-number">1.3.14.</span> <span class="nav-text">14、接（二、10）ResultMapResolver的resolve方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#15、MapperBuilderAssistant的addResultMap方法"><span class="nav-number">1.3.15.</span> <span class="nav-text">15、MapperBuilderAssistant的addResultMap方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#16、接（二、3）XMLMapperBuilder的sqlElement方法"><span class="nav-number">1.3.16.</span> <span class="nav-text">16、接（二、3）XMLMapperBuilder的sqlElement方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三、sql加载过程"><span class="nav-number">1.4.</span> <span class="nav-text">三、sql加载过程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1、接（二、3）XMLMapperBuilder的buildStatementFromContext方法"><span class="nav-number">1.4.1.</span> <span class="nav-text">1、接（二、3）XMLMapperBuilder的buildStatementFromContext方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2、XMLStatementBuilder的parseStatementNode方法"><span class="nav-number">1.4.2.</span> <span class="nav-text">2、XMLStatementBuilder的parseStatementNode方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3、XMLIncludeTransformer的applyIncludes方法"><span class="nav-number">1.4.3.</span> <span class="nav-text">3、XMLIncludeTransformer的applyIncludes方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4、XMLIncludeTransformer的findSqlFragment方法"><span class="nav-number">1.4.4.</span> <span class="nav-text">4、XMLIncludeTransformer的findSqlFragment方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5、接（三、2）XMLStatementBuilder的parseSelectKeyNodes方法"><span class="nav-number">1.4.5.</span> <span class="nav-text">5、接（三、2）XMLStatementBuilder的parseSelectKeyNodes方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6、XMLStatementBuilder的parseSelectKeyNodes方法"><span class="nav-number">1.4.6.</span> <span class="nav-text">6、XMLStatementBuilder的parseSelectKeyNodes方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7、XMLLanguageDriver的createSqlSource方法"><span class="nav-number">1.4.7.</span> <span class="nav-text">7、XMLLanguageDriver的createSqlSource方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8、XMLScriptBuilder的parseScriptNode方法"><span class="nav-number">1.4.8.</span> <span class="nav-text">8、XMLScriptBuilder的parseScriptNode方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9、XMLScriptBuilder的parseDynamicTags方法"><span class="nav-number">1.4.9.</span> <span class="nav-text">9、XMLScriptBuilder的parseDynamicTags方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10、If标签处理器"><span class="nav-number">1.4.10.</span> <span class="nav-text">10、If标签处理器</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  
</div>


  <div class="powered-by">Erstellt mit  <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
